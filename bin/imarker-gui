#!/usr/bin/env python3.6
# -*- mode: python; coding: utf-8 -*-

import logging
import webview

from threading import Thread
from http.server import HTTPServer
from optparse import OptionParser

from image_marker.server import LandingPage


def browser_thread(options):
    server = HTTPServer(('', int(options.port)), LandingPage)
    server.serve_forever()
    # server.socket.close()

parser = OptionParser()
parser.add_option(
    '-p', '--port',
    dest='port',
    default=8080,
    help='''The port operated by HTTP server.
            Defaults to 8080.''',
)

options, args = parser.parse_args()
logging.basicConfig(level=logging.INFO)

bt = Thread(target=browser_thread, args=(options,))
bt.daemon = True
bt.start()
webview.create_window(
    'Image Marker',
    'http://localhost:{}'.format(options.port),
)
